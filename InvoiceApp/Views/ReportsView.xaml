<UserControl x:Class="InvoiceApp.Views.ReportsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:oxy="http://oxyplot.org/wpf">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,20">
                <TextBlock Text="Reports and Analytics" 
                          FontSize="28" 
                          FontWeight="Bold"
                          Foreground="#2C3E50"/>
                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Content="🔄 Refresh" 
                           Command="{Binding RefreshCommand}"
                           Width="100"
                           Height="35"
                           Background="#3498DB"
                           Foreground="White"
                           BorderThickness="0"
                           Margin="0,0,10,0"/>
                    <Button Content="📊 Export to Excel" 
                           Command="{Binding ExportToExcelCommand}"
                           Width="150"
                           Height="35"
                           Background="#2ECC71"
                           Foreground="White"
                           BorderThickness="0"/>
                </StackPanel>
            </StackPanel>

            <!-- Summary Stats Cards -->
            <Grid Grid.Row="1" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Revenue Card -->
                <Border Grid.Column="0" 
                       Background="#3498DB" 
                       CornerRadius="8" 
                       Padding="20"
                       Margin="0,0,10,0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="💰" FontSize="32" Margin="0,0,0,10"/>
                        <TextBlock Text="Total Revenue" 
                                  FontSize="14" 
                                  Foreground="White" 
                                  Opacity="0.9"/>
                        <TextBlock Text="{Binding TotalRevenue, StringFormat=C}"
                                  FontSize="28" 
                                  FontWeight="Bold" 
                                  Foreground="White"
                                  Margin="0,5,0,0"/>
                        <TextBlock Text="{Binding TotalInvoices, StringFormat='{}{0} invoices'}" 
                                  FontSize="11" 
                                  Foreground="White" 
                                  Opacity="0.7"
                                  Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Total Paid Card -->
                <Border Grid.Column="1" 
                       Background="#2ECC71" 
                       CornerRadius="8" 
                       Padding="20"
                       Margin="0,0,10,0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="✅" FontSize="32" Margin="0,0,0,10"/>
                        <TextBlock Text="Total Paid" 
                                  FontSize="14" 
                                  Foreground="White" 
                                  Opacity="0.9"/>
                        <TextBlock Text="{Binding TotalPaid, StringFormat=C}"
                                  FontSize="28" 
                                  FontWeight="Bold" 
                                  Foreground="White"
                                  Margin="0,5,0,0"/>
                        <TextBlock Text="{Binding PaidInvoices, StringFormat='{}{0} paid'}" 
                                  FontSize="11" 
                                  Foreground="White" 
                                  Opacity="0.7"
                                  Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Outstanding Card -->
                <Border Grid.Column="2" 
                       Background="#E74C3C" 
                       CornerRadius="8" 
                       Padding="20">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="⚠️" FontSize="32" Margin="0,0,0,10"/>
                        <TextBlock Text="Outstanding" 
                                  FontSize="14" 
                                  Foreground="White" 
                                  Opacity="0.9"/>
                        <TextBlock Text="{Binding TotalOutstanding, StringFormat=C}"
                                  FontSize="28" 
                                  FontWeight="Bold" 
                                  Foreground="White"
                                  Margin="0,5,0,0"/>
                        <TextBlock Text="{Binding OverdueInvoices, StringFormat='{}{0} overdue'}" 
                                  FontSize="11" 
                                  Foreground="White" 
                                  Opacity="0.7"
                                  Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Revenue Chart -->
            <!-- Charts Side by Side -->
            <Grid Grid.Row="2" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Revenue by Month Chart -->
                <Border Grid.Column="0" 
           Background="White" 
           BorderBrush="#E0E0E0" 
           BorderThickness="1"
           CornerRadius="8" 
           Padding="20"
           Margin="0,0,10,0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="15" ShadowDepth="2" Opacity="0.15" Color="#2C3E50"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="📈 Revenue by Month" 
                      FontSize="18" 
                      FontWeight="Bold"
                      Foreground="#2C3E50"
                      Margin="0,0,0,15"/>
                        <oxy:PlotView Model="{Binding RevenueChartModel}" 
                         Height="300"/>
                    </StackPanel>
                </Border>

                <!-- Revenue Breakdown Pie Chart -->
                <Border Grid.Column="1" 
           Background="White" 
           BorderBrush="#E0E0E0" 
           BorderThickness="1"
           CornerRadius="8" 
           Padding="20"
           Margin="10,0,0,0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="15" ShadowDepth="2" Opacity="0.15" Color="#2C3E50"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="💰 Revenue Breakdown" 
                      FontSize="18" 
                      FontWeight="Bold"
                      Foreground="#2C3E50"
                      Margin="0,0,0,15"/>
                        <oxy:PlotView Model="{Binding RevenueBreakdownModel}" 
                         Height="300"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Top Clients & Aging Report Side by Side -->
            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Top Clients -->
                <Border Grid.Column="0" 
                       Background="White" 
                       BorderBrush="#E0E0E0" 
                       BorderThickness="1"
                       CornerRadius="8" 
                       Padding="20"
                       Margin="0,0,10,0">
                    <StackPanel>
                        <TextBlock Text="🏆 Top 10 Clients by Revenue" 
                                  FontSize="16" 
                                  FontWeight="Bold"
                                  Foreground="#2C3E50"
                                  Margin="0,0,0,15"/>
                        <DataGrid ItemsSource="{Binding TopClients}" 
                                 AutoGenerateColumns="False"
                                 IsReadOnly="True"
                                 GridLinesVisibility="None"
                                 HeadersVisibility="Column"
                                 Background="White"
                                 RowBackground="White"
                                 AlternatingRowBackground="#F8F9FA"
                                 BorderThickness="0"
                                 CanUserResizeRows="False"
                                 MaxHeight="400">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Client" Binding="{Binding ClientName}" Width="*"/>
                                <DataGridTextColumn Header="Revenue" Binding="{Binding TotalRevenue, StringFormat=C}" Width="100"/>
                                <DataGridTextColumn Header="Paid" Binding="{Binding PaidAmount, StringFormat=C}" Width="100"/>
                                <DataGridTextColumn Header="Invoices" Binding="{Binding InvoiceCount}" Width="70"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <!-- Aging Report -->
                <Border Grid.Column="1" 
                       Background="White" 
                       BorderBrush="#E0E0E0" 
                       BorderThickness="1"
                       CornerRadius="8" 
                       Padding="20"
                       Margin="10,0,0,0">
                    <StackPanel>
                        <TextBlock Text="📅 Aging Report" 
                                  FontSize="16" 
                                  FontWeight="Bold"
                                  Foreground="#2C3E50"
                                  Margin="0,0,0,15"/>
                        <DataGrid ItemsSource="{Binding AgingReport}" 
                                 AutoGenerateColumns="False"
                                 IsReadOnly="True"
                                 GridLinesVisibility="None"
                                 HeadersVisibility="Column"
                                 Background="White"
                                 RowBackground="White"
                                 AlternatingRowBackground="#F8F9FA"
                                 BorderThickness="0"
                                 CanUserResizeRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="*"/>
                                <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="60"/>
                                <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=C}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>